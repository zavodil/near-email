# near.email TESTNET Environment
# Copy this file to .env.testnet and fill in values
#
# Usage:
#   cp .env.testnet.example .env.testnet
#   docker-compose -f docker-compose.testnet.yml --env-file .env.testnet up -d

# Database password
POSTGRES_PASSWORD=testnet_password_change_me

# OutLayer API URL (testnet)
OUTLAYER_API_URL=https://testnet-api.outlayer.fastnear.com

# ============================================================
# MASTER_PUBLIC_KEY - Get from OutLayer after creating secret
# ============================================================
#
# Option 1: Fetch from OutLayer (recommended)
#   1. Create project "near-email-testnet" in OutLayer dashboard
#   2. Add secret PROTECTED_MASTER_KEY (type: Hex 32 bytes)
#   3. Fetch public key:
#      curl -X POST https://testnet-api.outlayer.fastnear.com/call/zavodil2.testnet/near-email \
#        -H "Content-Type: application/json" \
#        -d '{"action": "get_master_public_key"}'
#   4. Copy the "public_key" value here
#
# Option 2: Use test key (for local testing ONLY, not secure!)
#   Private: 0101010101010101010101010101010101010101010101010101010101010101
#   Public:  031b84c5567b126440995d3ed5aaba0565d71e1834604819ff9c17f5e9d5dd078f
#
MASTER_PUBLIC_KEY=031b84c5567b126440995d3ed5aaba0565d71e1834604819ff9c17f5e9d5dd078f

# ============================================================
# DKIM signing for outgoing emails
# ============================================================
# Generate RSA key pair:
#   openssl genrsa -out dkim.private.pem 2048
#   openssl rsa -in dkim.private.pem -pubout -out dkim.public.pem
#
# Then add DNS TXT record for mail._domainkey.near.email with the public key
#
# DKIM_PRIVATE_KEY should contain the full PEM key (including headers)
# For multiline values in .env, replace newlines with \n or use Docker secrets
#
DKIM_PRIVATE_KEY=
DKIM_SELECTOR=mail

# ============================================================
# SMTP Relay (optional - for better email deliverability)
# ============================================================
# Use a relay service like Resend, SendGrid, Mailgun to avoid
# IP reputation issues when sending directly to Gmail/Outlook.
#
# If not configured, emails are sent directly to MX servers.
#
# Resend example:
#   SMTP_RELAY_HOST=smtp.resend.com
#   SMTP_RELAY_PORT=587
#   SMTP_RELAY_USER=resend
#   SMTP_RELAY_PASSWORD=re_xxxxxxxxxxxx
#
# Set SMTP_RELAY_ENABLED=false to temporarily disable relay
# (useful for testing direct delivery)
#
SMTP_RELAY_HOST=
SMTP_RELAY_PORT=587
SMTP_RELAY_USER=resend
SMTP_RELAY_PASSWORD=
SMTP_RELAY_ENABLED=true

# ============================================================
# For WASI module deployment (OutLayer secrets)
# ============================================================
# Add these as secrets in OutLayer dashboard for project "near-email-testnet":
#
# | Secret Name            | Type           | Value                              |
# |------------------------|----------------|-------------------------------------|
# | PROTECTED_MASTER_KEY   | Hex 32 bytes   | (generate in dashboard)            |
# | DATABASE_API_URL       | Manual         | https://mail.near.email            |
# | DEFAULT_ACCOUNT_SUFFIX | Manual         | .testnet                           |
# | EMAIL_SIGNATURE        | Manual         | Sent onchain by %account% via OutLayer|
#
# Note: DATABASE_API_URL doesn't need authentication because all emails
# are stored encrypted. Only the WASI module (with PROTECTED_MASTER_KEY) can decrypt.

DEFAULT_ACCOUNT_SUFFIX=.testnet

# Email signature for outgoing emails (use %account% as placeholder for sender's NEAR account)
# This helps recipients identify that email was sent by a user, not by NEAR itself
EMAIL_SIGNATURE=Sent onchain by %account% via OutLayer

# ============================================================
# WEB UI params
# ============================================================

NEXT_PUBLIC_NETWORK_ID=testnet
NEXT_PUBLIC_OUTLAYER_API_URL=https://testnet-api.outlayer.fastnear.com
NEXT_PUBLIC_PROJECT_ID=zavodil2.testnet/near-email
NEXT_PUBLIC_SECRETS_PROFILE=default
NEXT_PUBLIC_SECRETS_ACCOUNT_ID=zavodil2.testnet

# ============================================================
# Poll secret for lightweight email notifications
# ============================================================
# Used by /poll/count endpoint to generate secure poll tokens.
# If not set, a random secret is generated on startup, which means
# all poll tokens become invalid after server restart.
#
# Generate with: openssl rand -hex 32
#
POLL_SECRET=your_poll_secret_change_me

SEND_INVITE_SUCCESS_EMAIL=true